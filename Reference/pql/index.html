<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Pql - Support Portal</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../iconmoon.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Support Portal</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Configuration/Advanced Permissions/">Advanced Permissions</a>
</li>
                            
<li >
    <a href="../../Configuration/Backups/">Backups</a>
</li>
                            
<li >
    <a href="../../Configuration/Barcode/">Barcode</a>
</li>
                            
<li >
    <a href="../../Configuration/Branding/">Branding</a>
</li>
                            
<li >
    <a href="../../Configuration/Logging/">Logging</a>
</li>
                            
<li >
    <a href="../../Configuration/Template Extraction/">Template Extraction</a>
</li>
                            
<li >
    <a href="../../Configuration/WebScan/">WebScan</a>
</li>
                            
<li >
    <a href="../../Configuration/Yaml Config/">Yaml Config</a>
</li>
                            
<li >
    <a href="../../Configuration/basic/">Basic</a>
</li>
                            
<li >
    <a href="../../Configuration/security/">Security</a>
</li>
                            
<li >
    <a href="../../Configuration/solution-pack/">Solution pack</a>
</li>
                            
<li >
    <a href="../../Configuration/ssl/">Ssl</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Installation/Desktop Agent/">Desktop Agent</a>
</li>
                            
<li >
    <a href="../../Installation/Replication/">Replication</a>
</li>
                            
<li >
    <a href="../../Installation/Sizing/">Sizing</a>
</li>
                            
<li >
    <a href="../../Installation/Ubuntu-Linux/">Ubuntu Linux</a>
</li>
                            
<li >
    <a href="../../Installation/Windows/">Windows</a>
</li>
                            
<li >
    <a href="../../Installation/end-user-installation/">End user installation</a>
</li>
                            
<li >
    <a href="../../Installation/macosx/">Macosx</a>
</li>
                            
<li >
    <a href="../../Installation/server-installation/">Server installation</a>
</li>
                            
<li >
    <a href="../../Installation/service/">Service</a>
</li>
                            
<li >
    <a href="../../Installation/solution/">Solution</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Integration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Integration/Database/">Database</a>
</li>
                            
<li >
    <a href="../../Integration/EasyPDF/">EasyPDF</a>
</li>
                            
<li >
    <a href="../../Integration/Folder Export/">Folder Export</a>
</li>
                            
<li >
    <a href="../../Integration/data-sources/">Data sources</a>
</li>
                            
<li >
    <a href="../../Integration/email-watch/">Email watch</a>
</li>
                            
<li >
    <a href="../../Integration/folder-watch/">Folder watch</a>
</li>
                            
<li >
    <a href="../../Integration/ldap-ad/">Ldap ad</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Cold Standby Failover Procedure/">Cold Standby Failover Procedure</a>
</li>
                            
<li >
    <a href="../Document Properties/">Document Properties</a>
</li>
                            
<li >
    <a href="../Linking/">Linking</a>
</li>
                            
<li >
    <a href="../Logging/">Logging</a>
</li>
                            
<li >
    <a href="../System-Nodes/">System Nodes</a>
</li>
                            
<li >
    <a href="../health/">Health</a>
</li>
                            
<li >
    <a href="../licensing/">Licensing</a>
</li>
                            
<li >
    <a href="../linking_syntax/">Linking syntax</a>
</li>
                            
<li >
    <a href="../maintenance/">Maintenance</a>
</li>
                            
<li class="active">
    <a href="./">Pql</a>
</li>
                            
<li >
    <a href="../regex/">Regex</a>
</li>
                            
<li >
    <a href="../standard_expression/">Standard expression</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Troubleshooting/Performance/">Performance</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/Troubleshooting Client/">Troubleshooting Client</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/Troubleshooting Server/">Troubleshooting Server</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/cpu-usage/">Cpu usage</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/db-tuning/">Db tuning</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/exceptions/">Exceptions</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../maintenance/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../regex/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#pql">PQL</a></li>
            <li><a href="#syntax">Syntax</a></li>
            <li><a href="#column-expressions">Column Expressions</a></li>
            <li><a href="#from-clause">FROM Clause</a></li>
            <li><a href="#where">WHERE</a></li>
            <li><a href="#order-by">ORDER BY</a></li>
            <li><a href="#group-by">GROUP BY</a></li>
            <li><a href="#having">HAVING</a></li>
            <li><a href="#escaping">Escaping</a></li>
            <li><a href="#virtual-data-sources">Virtual Data Sources</a></li>
            <li><a href="#workflowhistory">@WorkflowHistory</a></li>
            <li><a href="#activity">@Activity</a></li>
            <li><a href="#queuehistory">@QueueHistory</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="pql">PQL</h1>
<p>PQL is an SQL-like language that can be used for querying and filtering data in PaperTrail. It can be used in the following places:  </p>
<ul>
<li>
<p>Anywhere where a query expression is used e.g. Advanced Search Reports, Queues, Scheduled Rules, Document linking etc.</p>
</li>
<li>
<p>As an alternative to groovy based expressions on node rule filters
e.g. instead of:
<code>filename == 'filename &amp;&amp; a == 'b'</code>
Use:</p>
</li>
</ul>
<pre><code class="sql">WHERE filename = 'filename' AND a = 'b'
</code></pre>

<p>PQL filters are fully case-insensitive and null safe so instead of: <code>index1 != null &amp;&amp; index1.toLowerCase() == 'abc'</code><br />
Use:
<code>WHERE index1 = 'abc'</code></p>
<h2 id="syntax">Syntax</h2>
<p>The <code>SELECT</code> clause MUST contain exactly one of the following:</p>
<ul>
<li>
<p>A comma-separated list of one or more column names (node or document index names).  </p>
<ul>
<li>You can use aliases to rename returned columns, e.g. column AS alias.  </li>
<li>If an explicit column list is provided: Only the columns listed will be returned and only in the order supplied.  </li>
<li>Note : All standard indexes and any custom indexes will be returned in the default order  </li>
<li>Note : Only custom indexes will be returned </li>
</ul>
</li>
<li>
<p>One or more calls to aggregate functions.</p>
<ul>
<li>Aggregate functions produce a single row output from multiple rows in a group.</li>
</ul>
</li>
</ul>
<h2 id="column-expressions">Column Expressions</h2>
<p>Groovy expressions can be used to format data returned e.g. </p>
<pre><code class="sql">SELECT '${name[0]}' as Initial FROM Clients
</code></pre>

<p>Multiple columns can also be referenced:</p>
<pre><code class="sql">SELECT '${LastName}, ${FirstName}' as FullName FROM Clients
</code></pre>

<p>As well as arithmetic on Number and Double indexes:</p>
<pre><code class="sql">SELECT '${total + vat}' as GrandTotal FROM 'Sales'
</code></pre>

<h2 id="from-clause">FROM Clause</h2>
<p>The FROM clause identifies which Virtual Table (Node) the query will be run against, as described in the previous section.</p>
<p>The FROM clause MUST contain the full path of a node, and MUST be single quoted if there are any spaces .e.g</p>
<p><code>FROM parent/division</code>
<code>FROM 'parent/sub folder/folder'</code></p>
<h2 id="where">WHERE</h2>
<p>This clause identifies the constraints that rows MUST satisfy to be considered a result for the query.</p>
<p>All column names MUST be valid “queryName” or their aliased values for properties that are defined as “queryable” in the Object-Type(s) whose Virtual Tables are listed in the FROM clause.</p>
<p>Properties are defined to not support a “null” value, therefore the <null predicate> MUST be interpreted as testing the not set or set state of the specified property.</p>
<p>Comparisons permitted in the WHERE clause.</p>
<p>PQL supports the following predicates:</p>
<ul>
<li>= (equals)  </li>
<li>> (bigger than, after)  </li>
<li>&lt; (smaller than, before)  </li>
</ul>
<blockquote>
<p>Note: Bigger than / Less than and end equal to (&gt;=, &lt;=) are not supported</p>
</blockquote>
<p>Date values can be relative e.g.:</p>
<pre><code class="sql">SELECT docId FROM queryTests2 WHERE date1 &gt; '+7d'
</code></pre>

<ul>
<li>contains</li>
<li>not contains</li>
<li>startsWith</li>
<li>not startsWith</li>
<li>endWith</li>
<li>
<p>not endsWith
BETWEEN and NOT BETWEEN predicates to compare on ranges
e.g. column BETWEEN a AND b, is equivalent to column &gt;= a AND column &lt;= b </p>
</li>
<li>
<p>IN  </p>
</li>
<li>LIKE   </li>
<li>IS NULL  </li>
<li>IS NOT NULL  </li>
<li>all_empty  <blockquote>
<p>e.g. a filter that matches when all 4 indexes are populated
WHERE not all_empty (invoice_no,total,date,approved)</p>
</blockquote>
</li>
<li>not all_empty  </li>
<li>before, after   </li>
</ul>
<pre><code class="sql">WHERE createdDate BEFORE '2015-01-01'
</code></pre>

<h3 id="where-expressions">WHERE Expressions</h3>
<p>Expressions can also be on both the left and and right side of WHERE clauses. e.g.</p>
<pre><code class="sql">SELECT name FROM Customers WHERE '${name[0]}' = 'A'
</code></pre>

<p>OR</p>
<pre><code class="sql">SELECT number1 FROM queryTests2 WHERE 99 &gt; ${number1 + pqldouble1}
</code></pre>

<h2 id="order-by">ORDER BY</h2>
<ul>
<li>This clause MUST use a single column to order by.</li>
<li>All column names referenced in this clause MUST be valid “queryName” or alias (either for an aggregate function result or a column).</li>
<li>Only columns in the SELECT clause MAY be in the ORDER BY clause.</li>
</ul>
<h2 id="group-by">GROUP BY</h2>
<p>This clause specifies one or many columns to group by.</p>
<p>Supported functions:</p>
<ul>
<li><code>COUNT(column</code>, <code>COUNT(*)</code> - returns a number of entries in a group. COUNT(column) skips null values.</li>
<li><code>AVG(column)</code> - returns an average value of a column in a group.</li>
<li><code>MIN(column)</code>, <code>MAX(column)</code> - return a minimal or maximal value of a certain column in a group.</li>
<li><code>SUM(column)</code> - returns a sum of a column in a group.</li>
</ul>
<p>Column references can also include groovy expressions e.g. </p>
<pre><code class="sql">SELECT sum(${time/60}) FROM Time  GROUP BY createdBy
</code></pre>

<h2 id="having">HAVING</h2>
<p>Having is used to filter on values that have been grouped e.g.</p>
<pre><code class="sql">SELECT text1, SUM(number1) FROM queryTests2 GROUP BY text1 HAVING SUM(number1) &gt; 10
</code></pre>

<p>OR</p>
<pre><code class="sql">SELECT text1, SUM(\${number1 * 10}) AS totals FROM queryTests2 GROUP BY text1 HAVING totals &gt; 1000
</code></pre>

<h2 id="escaping">Escaping</h2>
<p>Repositories MUST support the escaping of characters using a backslash <code>\</code> in the query statement.  The backslash character <code>\</code> will be used to escape characters within quoted strings in the query as follows:</p>
<ul>
<li>\’ will represent a single-quote(‘) character</li>
<li>\ \ will represent a backslash <code>\</code> character</li>
<li>Within a LIKE string, <code>\%</code> and <code>\_</code> will represent the literal characters % and _, respectively.</li>
<li>All other instances of a \ are errors.</li>
</ul>
<h2 id="virtual-data-sources">Virtual Data Sources</h2>
<p><code>FROM '@{VirtualDataSource}</code></p>
<h2 id="workflowhistory">@WorkflowHistory</h2>
<p>The workflow history virtual data source will return details about the unassigned and human tasks of a one or more documents e.g. </p>
<pre><code class="sql">SELECT * FROM '@WorkflowHistory' WHERE docId = 1
</code></pre>

<p>Will return the following special columns:</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>allocation</td>
<td>The final user allocated</td>
</tr>
<tr>
<td>createdBy</td>
<td>Who the allocation was created by. This is not the creator of the document.</td>
</tr>
<tr>
<td>position</td>
<td>The workflow label of the task</td>
</tr>
<tr>
<td>duration</td>
<td>The duration of the task e.g. 12 hours</td>
</tr>
<tr>
<td>businessDuration</td>
<td>The duration of the task while in business hours e.g. 2 hours</td>
</tr>
<tr>
<td>start</td>
<td>The start date of the task</td>
</tr>
<tr>
<td>end</td>
<td>The end date of the task</td>
</tr>
<tr>
<td>durationMillis</td>
<td>The duration of the task in milliseconds</td>
</tr>
</tbody>
</table>
<p>Any standard and custom indexes can also be merged into the results by adding them into the column list.
Any standard search criteria can also be used</p>
<h2 id="activity">@Activity</h2>
<p>Returns: </p>
<ul>
<li>Document creations </li>
<li>New Notes </li>
<li>Audits of configurable type = defaulting to Check In, Forward, Delete </li>
</ul>
<pre><code class="sql">SELECT * FROM @Activity WHERE Node = 'Finance' AND user = 'X' 
</code></pre>

<p>equivalent to: </p>
<pre><code class="sql">SELECT * FROM @Activity/Finance WHERE user = 'X' 
</code></pre>

<p><code>date</code> is used for searching on the activity date (not the date of the document)</p>
<pre><code class="sql">SELECT * FROM @Activity WHERE date = '-7d' 
</code></pre>

<h2 id="queuehistory">@QueueHistory</h2></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2016 Egis Software</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
